start
  = body

/*-------------------------------------------------------------------------------------------------------------------------------------
   body is defined as anything that matches with the part 0 or more times
---------------------------------------------------------------------------------------------------------------------------------------*/
body
  = p:item*

item
  = section / yield / include / buffer

buffer
  = e:eol w:ws*
  { return [ "buffer", e, w.join(''), column() ] }
  / b:(!section !section_stop !include !yield c:. { return c })+
  { return [ "buffer", b.join(''), column() ] }

include
  = "@include" name:section_name {return ['include', name]}

section
  = section_open name:section_name eol:eol? body:body n:section_stop? { return ['section', name, ['content', body], {start: line(), end: n}] }

section_name
  = open_brace out:(!quote c:. {return c})+ close_brace { return out.join("") }

section_open
  = s:section_id "section"

yield
  = section_id "yield" name:section_name eol:eol? {return ['yield', name, {start: column()}]}

section_id
  = "@"

section_stop "section stop"
  = "@stop" b:eol? { return line() }

quote
  = '"'

open_brace
  = '(' quote

close_brace
  = quote ')'

any
  = (after:. {return after})+

eol
  = "\n"        //line feed
  / "\r\n"      //carriage + line feed
  / "\r"        //carriage return
  / "\u2028"    //line separator
  / "\u2029"    //paragraph separator

ws
  = [\t\v\f \u00A0\uFEFF] / eol

